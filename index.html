<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Chat App</title>
    <link rel="stylesheet" href="global.css" />

    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
      }
      #chatContainer {
        text-align: center;
        background-color: green;
        padding: 20%;
        border-radius: 10%;
      }
      #loginForm {
        display: inline-block;
        text-align: center;
      }
      #username {
        margin-bottom: 10px;
      }
      #messages {
        list-style-type: none;
        padding: 0;
        margin-top: 20px;
        overflow-y: auto;
        max-height: 60vh;
        background-color: pink;
        text-align: left;
      }
      #messages li {
        margin-bottom: 10px;
        background-color: yellow;
      }
      /* Düzeltme için eklenen kısım */
      #messageForm {
        display: flex;
        flex-direction: column; /* İçeriği sütun halinde düzenle */
        align-items: center;
        margin-top: 10px;
        background-color: brown;
      }
      #messageForm input,
      #messageForm button {
        margin-bottom: 10px; /* Input alanı ve button arasına boşluk bırak */
      }
      #messageForm button {
        width: 100px; /* Buttonun genişliğini ayarla */
      }
    </style>
  </head>
  <body>
    <div class="login-page">
      <div class="form">
        <form class="register-form">
          <input type="text" placeholder="name" />
        </form>

        <form id="loginForm">
          <input
            id="username"
            type="text"
            placeholder="Enter your name"
            autocomplete="off"
            required
          />
          <button type="submit">Join Chat</button>
        </form>

        <ul id="messages"></ul>

        <form id="messageForm" style="display: none">
          <div>
            <input
              id="input"
              type="text"
              autocomplete="off"
              placeholder="Type a message..."
              required
            />
            <button type="submit">Send</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      const loginForm = document.getElementById("loginForm");
      const usernameInput = document.getElementById("username");

      const messageForm = document.getElementById("messageForm");
      const input = document.getElementById("input");
      const messages = document.getElementById("messages");

      let username = "";

      const ws = new WebSocket("ws://localhost:8080");
      console.log("*********      **************");

      ws.onopen = function () {
        console.log("Connected to the server");
        console.log("***********************");
      };

      ws.onmessage = function (event) {
        const messageData = JSON.parse(event.data);
        //displayMessageOnScreen(messageData.name + ": " + messageData.message);
        allMessages.push(messageData); // Yeni gelen mesajı diziye ekle
        displayAllMessages(); // Tüm mesajları ekrana bas
      };

      function displayAllMessages() {
        // Tüm mesajları ekrana bas
        messages.innerHTML = ""; // Önceki mesajları temizle
        allMessages.forEach(function (messageData) {
          const item = document.createElement("li");
          item.textContent = messageData.name + ": " + messageData.message;
          messages.appendChild(item);
        });
      }

      function displayMessageOnScreen(message) {
        console.log("displayMessageOnScreen fonksiyonu çağrıldı");
        const item = document.createElement("li");
        item.textContent = message;
        messages.appendChild(item);
      }

      loginForm.onsubmit = function (event) {
        event.preventDefault();
        username = usernameInput.value;
        console.log(" loginForm.onsubmit = function (event) {");

        if (username) {
          loginForm.style.display = "none";
          messageForm.style.display = "block";
        }
      };

      messageForm.onsubmit = function (event) {
        event.preventDefault();
        const message = input.value;
        console.log("messageForm.onsubmit = function (event) {");
        if (message && username) {
          ws.send(JSON.stringify({ name: username, message: message }));
          input.value = "";
          displayMessageOnScreen(username + ": " + message);
        }
      };
    </script>
  </body>
</html>
