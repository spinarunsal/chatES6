<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Chat App</title>
    <link rel="stylesheet" href="global.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
      }
      #chatContainer {
        text-align: center;
        background-color: green;
        padding: 20%;
        border-radius: 10%;
      }
      #loginForm {
        display: inline-block;
        text-align: center;
        background-color: antiquewhite;
      }
      #username {
        margin-bottom: 10px;
      }
      #messages {
        list-style-type: none;
        padding: 0;
        margin-top: 20px;
        min-height: 40vh;
        max-height: 40vh;
        background-color: pink;
        text-align: left;
        overflow-y: auto;
      }
      #messages li {
        margin-bottom: 10px;
        background-color: yellowgreen;
        border-radius: 10%;
        padding: 10px;
      }
      /* Düzeltme için eklenen kısım */
      #messageForm {
        display: flex;
        align-items: center;
        margin-top: 10px;
        background-color: brown;
        /*  padding: 10px; */
        border-radius: 5px;
      }
      #messageForm input {
        flex: 3;
        margin-right: 10px;
        margin-top: 10px;
        border-radius: 5px;
      }
      #messageForm button {
        width: 100px;
        border-radius: 5px;
        margin-left: 10px; /* Butonun sol tarafına boşluk bırak */
      }
    </style>
  </head>
  <body>
    <div class="login-page">
      <div class="form">
        <form id="loginForm">
          <input
            id="username"
            type="text"
            placeholder="Enter your name"
            autocomplete="off"
            required
          />
          <button type="submit">Join Chat</button>
        </form>

        <ul id="messages"></ul>

        <form id="messageForm" style="display: none">
          <input
            id="input"
            type="text"
            autocomplete="off"
            placeholder="Type a message..."
            required
          />
          <button type="submit">Send</button>
        </form>
      </div>
    </div>

    <script>
      const loginForm = document.getElementById("loginForm");
      const usernameInput = document.getElementById("username");

      const messageForm = document.getElementById("messageForm");
      const input = document.getElementById("input");
      const messages = document.getElementById("messages");

      let username = "";
      const allMessages = []; // Tüm mesajları sakla

      const ws = new WebSocket("ws://localhost:8080");

      ws.onopen = function () {
        console.log("Connected to the server");
      };

      ws.onmessage = function (event) {
        const messageData = JSON.parse(event.data);
        console.log("ws.onmessage = function (event) {");
        console.log(messageData);
        allMessages.push(messageData);
        displayAllMessages();
      };

      function displayAllMessages() {
        // Önceki mesajları temizle
        messages.innerHTML = "";
        console.log("messages ds", messages);
        // Tüm mesajları ekrana bas
        allMessages.forEach(function (messageData) {
          const item = document.createElement("li");
          item.textContent = messageData.name + ": " + messageData.message;
          messages.appendChild(item);
        });
      }

      function displayMessageOnScreen(message) {
        console.log("displayMessageOnScreen(message)", message);

        const item = document.createElement("li");
        item.textContent = JSON.stringify(message);

        messages.appendChild(item);
        console.log("messagesP", messages);
      }

      loginForm.onsubmit = function (event) {
        console.log("loginForm.onsubmit = function (event) {");

        event.preventDefault();
        username = usernameInput.value;

        if (username) {
          loginForm.style.display = "none";
          messageForm.style.display = "flex"; // Set the message form to flex display
        }
      };

      messageForm.onsubmit = function (event) {
        console.log("messageForm.onsubmit = function (event) {");

        event.preventDefault();
        const message = input.value;

        if (message && username) {
          ws.send(JSON.stringify({ name: username, message: message }));
          input.value = "";
          displayMessageOnScreen(username + ": " + message);
          //displayAllMessages();
        }
      };
    </script>
  </body>
</html>
